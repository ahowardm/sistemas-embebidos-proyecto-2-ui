<!DOCTYPE html>
<html lang="es">
  <head>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"
    />
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <title>Arduino Serial UI</title>
  </head>
  <body>
    <nav>
      <div class="nav-wrapper">
        <a class="brand-logo center">Arduino UI</a>
      </div>
    </nav>
    <div class="container">
      <div class="row">
        <form>
          <div class="input-field col s4">
            <input
              placeholder="Puerto"
              id="port"
              type="text"
              class="validate"
            />
          </div>
          <div class="input-field col s4">
            <button
              class="btn waves-effect waves-light"
              type="submit"
              name="action"
            >
              Enviar
              <i class="material-icons right">send</i>
            </button>
          </div>
        </form>
      </div>

      <div class="row">
        <h5>Led 0</h5>
        <div class="col s4">
          <a class="waves-effect waves-light btn" id="turnL0On">Prende</a>
        </div>
        <div class="col s4">
          <a class="waves-effect waves-light btn" id="turnL0Off">Apaga</a>
        </div>
      </div>
      <div class="row">
        <h5>Led 1</h5>
        <div class="col s4">
          <a class="waves-effect waves-light btn" id="turnL1On">Prende</a>
        </div>
        <div class="col s4">
          <a class="waves-effect waves-light btn" id="turnL1Off">Apaga</a>
        </div>
      </div>
      <div class="row">
        <h5>Botones</h5>
        <div class="col s4">
          <a class="waves-effect waves-light btn" id="readS0">Leer S0</a>
        </div>
        <div class="col s4">
          <a class="waves-effect waves-light btn" id="readS1">Leer S1</a>
        </div>
        <div class="col s4">
          <input
            value="I am not editable"
            id="disabled"
            class="validate"
            type="hidden"
            disabled
          />
        </div>
      </div>
      <div class="row">
        <h5>PWM</h5>
        <div class="col s4">
          <a class="waves-effect waves-light btn" id="setPwmL0">Fijar L0</a>
        </div>
        <div class="col s4">
          <a class="waves-effect waves-light btn" id="setPwmL1">Fijar L1</a>
        </div>
        <div class="col s4">
          <input
            placeholder="Ingresa un valor entre 0 y 255"
            id="pwm-value"
            class="validate"
            type="text"
          />
        </div>
      </div>

      <div class="row">
        <a class="waves-effect waves-light btn red" id="turnAllOff"
          >Apagar Todo</a
        >
      </div>
    </div>

    <script>
      const electron = require("electron");
      const { ipcRenderer } = electron;

      const form = document.querySelector("form");
      form.addEventListener("submit", e => {
        e.preventDefault();
        const port = document.querySelector("#port").value;
        ipcRenderer.send("setPort", port);
      });

      const turnL0On = document.getElementById("turnL0On");
      const turnL0Off = document.getElementById("turnL0Off");
      const turnL1On = document.getElementById("turnL1On");
      const turnL1Off = document.getElementById("turnL1Off");
      const readS0 = document.getElementById("readS0");
      const readS1 = document.getElementById("readS1");
      const setPwmL0 = document.getElementById("setPwmL0");
      const setPwmL1 = document.getElementById("setPwmL1");
      const turnAllOff = document.getElementById("turnAllOff");

      turnL0On.addEventListener("click", () => {
        ipcRenderer.send("turnL0On");
      });
      turnL0Off.addEventListener("click", () => {
        ipcRenderer.send("turnL0Off");
      });
      turnL1On.addEventListener("click", () => {
        ipcRenderer.send("turnL1On");
      });
      turnL1Off.addEventListener("click", () => {
        ipcRenderer.send("turnL1Off");
      });
      readS0.addEventListener("click", () => {
        ipcRenderer.send("readS0");
      });
      readS1.addEventListener("click", () => {
        ipcRenderer.send("readS1");
      });
      setPwmL0.addEventListener("click", () => {
        const pwmValue = document.getElementById("pwm-value").value;
        ipcRenderer.send("setPwmL0", pwmValue);
      });
      setPwmL1.addEventListener("click", () => {
        const pwmValue = document.getElementById("pwm-value").value;
        ipcRenderer.send("setPwmL1", pwmValue);
      });
      turnAllOff.addEventListener("click", () => {
        ipcRenderer.send("turnAllOff");
      });

      ipcRenderer.on("buttonStatus", (event, message) => {
        console.log(message);
        showHiddenField(message);
      });

      const showHiddenField = status => {
        const field = document.getElementById("disabled");
        field.setAttribute("type", "text");
        if (status == 1) field.value = "Botón presionado";
        else if (status == 0) field.value = "Botón sin presionar";
      };
    </script>
  </body>
</html>
